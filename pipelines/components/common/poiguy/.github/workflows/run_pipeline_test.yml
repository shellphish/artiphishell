name: Test on Last Good Pipeline Run
on:
    - push
    - workflow_dispatch
jobs:
  tests:
    runs-on: self-hosted
    name: Test ${{ matrix.tasks.name }} on last good working pipeline
    strategy:
      fail-fast: false
      matrix:
        tasks:
          - name: poiguy_asan
            maintainers: <@607072365808975882> <@320594955779309569>
          - name: poiguy_jazzer
            maintainers: <@607072365808975882> <@320594955779309569>
            
    steps:
      - uses: shellphish-support-syndicate/action-test-component@main
        timeout-minutes: 30
        with:
          ci-deploy-token: ${{ secrets.CI_DEPLOY_TOKEN }}
          ci-ssh-key: ${{ secrets.CI_SSH_PRIVATE_KEY }}
          ghcr-username: ${{ secrets.GHCR_USERNAME }}
          ghcr-password: ${{ secrets.GHCR_PASSWORD }}
          github-token: ${{ secrets.GITHUB_TOKEN }}
          github-user: ${{ github.actor }}
          component-dir: components/common/poiguy
          task-name: ${{ matrix.tasks.name }}
          maintainers: ${{ matrix.tasks.maintainers }}
          discord-webhook: ${{ secrets.DISCORD_CI_WEBHOOK }}
