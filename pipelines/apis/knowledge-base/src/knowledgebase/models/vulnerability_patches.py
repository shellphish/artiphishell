from neomodel import StructuredNode, RelationshipTo, RelationshipFrom, StringProperty, ZeroOrMore
from .git_repo import Commit, FileModification, SourceFile
from .cve import CVE
from .jenkins_security_advisory import JenkinsAdvisory


class Project(StructuredNode):
    projectName = StringProperty(required=True)
    projectSource = StringProperty(required=True)
    sourceFiles = RelationshipTo("SourceFile", "PROJECT_SOURCE_FILE", cardinality=ZeroOrMore)
    vulnerabilities = RelationshipTo("VulnerabilityPatch", "PROJECT_VULNERABILITIES", cardinality=ZeroOrMore)


class VulnerabilityPatch(StructuredNode):

    vulnerabilityIdentifier = StringProperty(unique_index=True, required=True)

    patchType = StringProperty()

    vulnerable_commit = RelationshipFrom('Commit', 'VULNERABLE_COMMIT')
    patching_commit = RelationshipFrom('Commit', 'PATCHING_COMMIT')

    sec_advisory = RelationshipFrom('JenkinsAdvisory', 'ADVISORY_PATCH', cardinality=ZeroOrMore)
    cve_reference = RelationshipFrom('CVE', 'CVE_PATCH', cardinality=ZeroOrMore)

    file_modifications = RelationshipTo('FileModification', 'PATCHED_FILE')
