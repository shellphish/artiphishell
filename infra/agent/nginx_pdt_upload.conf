server {
    listen 8040 default_server;
    server_name _;

    # Allow very large uploads (no enforced limit)
    client_max_body_size 0;

    # Serve static files from cache directory
    location ~ ^/cache/(.+)$ {
        alias /pdt/agent-state/nginx_cache/$1;
        
        # Only allow GET and HEAD requests for downloading/checking files
        limit_except GET HEAD {
            deny all;
        }
    }

    # Enable WebDAV methods for simple file uploads via PUT/DELETE, etc.
    location ~ ^/data/(.+)$ {
        alias /tmp/pdt-uploads/$1;
        client_body_timeout 30000s;
        client_body_temp_path /tmp/nginx_temp;

        dav_methods PUT DELETE;
        dav_access user:rw group:rw all:rw;
        create_full_put_path on;

        limit_except PUT {
            deny all;
        }
    }
} 